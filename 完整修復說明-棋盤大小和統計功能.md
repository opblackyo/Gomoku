# å®Œæ•´ä¿®å¾©èªªæ˜ - æ£‹ç›¤å¤§å°å’Œçµ±è¨ˆåŠŸèƒ½

## ä¿®å¾©çš„å•é¡Œ

### 1. âœ… æ£‹ç›¤å¤§å°éå¤§
åœ¨15å‹è¢å¹•ä¸Šï¼Œæ£‹ç›¤å°ºå¯¸éå¤§ï¼Œå°è‡´åº•éƒ¨æŒ‰éˆ•è¢«è¦†è“‹æˆ–éœ€è¦æ»¾å‹•ã€‚

### 2. âœ… å‹è² è¨ˆæ•¸æ²’æœ‰ä½œç”¨
ç©å®¶è³‡è¨Šé¡¯ç¤ºå›ºå®šçš„ "0å‹ 0æ•— 0ç„¡"ï¼Œæ²’æœ‰å¯¦éš›çµ±è¨ˆåŠŸèƒ½ã€‚

## è§£æ±ºæ–¹æ¡ˆ

### ä¸€ã€é€²ä¸€æ­¥ç¸®å°æ£‹ç›¤å°ºå¯¸

#### 1.1 èª¿æ•´éŸ¿æ‡‰å¼æ–·é»ï¼ˆBoardComponent.vueï¼‰

```css
/* å°å‹æ¡Œé¢/ç­†é›» (769px-1024px) - å¦‚ 15å‹ç­†é›» */
@media (min-width: 769px) and (max-width: 1024px) {
  .board-wrapper {
    --cell-size: 24px;  /* å¾ 28px é™ä½åˆ° 24px */
  }
}

/* ä¸­å‹æ¡Œé¢ (1025px-1440px) */
@media (min-width: 1025px) and (max-width: 1440px) {
  .board-wrapper {
    --cell-size: 30px;  /* å¾ 34px é™ä½åˆ° 30px */
  }
}

/* å¤§å‹æ¡Œé¢ (>1440px) */
@media (min-width: 1441px) {
  .board-wrapper {
    --cell-size: 36px;  /* å¾ 40px é™ä½åˆ° 36px */
  }
}
```

#### 1.2 æ·»åŠ é«˜åº¦å„ªåŒ–ï¼ˆBoardComponent.vueï¼‰

é‡å°å°é«˜åº¦è¢å¹•çš„ç‰¹æ®Šå„ªåŒ–ï¼š

```css
/* é‡å°å°é«˜åº¦è¢å¹•çš„ç‰¹æ®Šå„ªåŒ– */
@media (max-height: 768px) and (min-width: 769px) {
  .board-wrapper {
    --cell-size: 22px;  /* æ¥µå°å°ºå¯¸ä»¥é©æ‡‰å°é«˜åº¦è¢å¹• */
  }
  .coord-label {
    font-size: 0.65rem;
  }
  .board-container {
    padding: 0.25rem;
  }
}

@media (min-height: 769px) and (max-height: 900px) and (min-width: 769px) {
  .board-wrapper {
    --cell-size: 26px;  /* ä¸­ç­‰å°ºå¯¸ */
  }
}
```

### äºŒã€å¯¦ç¾å®Œæ•´çš„çµ±è¨ˆåŠŸèƒ½

#### 2.1 å‰µå»ºçµ±è¨ˆæœå‹™ï¼ˆbackend/src/modules/stats/stats.service.tsï¼‰

```typescript
@Injectable()
export class StatsService {
  private playerStats: Map<string, PlayerStats> = new Map();

  getPlayerStats(playerName: string): PlayerStats {
    if (!this.playerStats.has(playerName)) {
      this.playerStats.set(playerName, {
        wins: 0,
        losses: 0,
        draws: 0,
      });
    }
    return this.playerStats.get(playerName)!;
  }

  initializePlayerStats(player: Player): Player {
    const stats = this.getPlayerStats(player.name);
    return { ...player, stats };
  }

  updateGameResult(winnerName: string, loserName: string): void {
    this.recordWin(winnerName);
    this.recordLoss(loserName);
  }
}
```

#### 2.2 æ›´æ–°é…å°æœå‹™ï¼ˆmatchmaking.service.tsï¼‰

åœ¨å‰µå»ºç©å®¶æ™‚åˆå§‹åŒ–çµ±è¨ˆæ•¸æ“šï¼š

```typescript
async addToQueue(socketId: string, playerName: string) {
  const player: Player = {
    id: uuidv4(),
    name: playerName,
    socketId,
  };

  // åˆå§‹åŒ–ç©å®¶çµ±è¨ˆæ•¸æ“š
  const playerWithStats = this.statsService.initializePlayerStats(player);
  this.queue.push(playerWithStats);
  // ...
}
```

#### 2.3 æ›´æ–°éŠæˆ²ç¶²é—œï¼ˆgame.gateway.tsï¼‰

åœ¨éŠæˆ²çµæŸæ™‚æ›´æ–°çµ±è¨ˆï¼š

```typescript
// æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸ
const result = this.gameService.checkGameEnd(updatedRoom, move);
if (result) {
  // æ›´æ–°çµ±è¨ˆæ•¸æ“š
  this.updatePlayerStats(updatedRoom, result.winner);
  
  this.server.to(room.id).emit('game.result', result);
  // ...
}

// ç§æœ‰æ–¹æ³•ï¼šæ›´æ–°ç©å®¶çµ±è¨ˆ
private updatePlayerStats(room: any, winnerId?: string): void {
  if (!winnerId || !room.players || room.players.length < 2) {
    return;
  }

  const winner = room.players.find((p: any) => p.id === winnerId);
  const loser = room.players.find((p: any) => p.id !== winnerId);

  if (winner && loser) {
    this.statsService.updateGameResult(winner.name, loser.name);
    
    // æ›´æ–°æˆ¿é–“ä¸­çš„ç©å®¶çµ±è¨ˆæ•¸æ“š
    room.players = room.players.map((p: any) => 
      this.statsService.initializePlayerStats(p)
    );
  }
}
```

#### 2.4 è¨»å†Šæœå‹™ï¼ˆapp.module.tsï¼‰

```typescript
@Module({
  imports: [],
  providers: [
    GameGateway,
    MatchmakingService,
    RoomService,
    GameService,
    StatsService,  // æ–°å¢
  ],
})
export class AppModule {}
```

## ä¿®æ”¹çš„æ–‡ä»¶æ¸…å–®

### å‰ç«¯
1. **frontend/src/components/BoardComponent.vue**
   - é€²ä¸€æ­¥ç¸®å°æ£‹æ ¼å°ºå¯¸
   - æ·»åŠ é‡å°å°é«˜åº¦è¢å¹•çš„å„ªåŒ–

2. **frontend/src/views/GameView.vue**
   - æ·»åŠ  `getPlayerStats()` å‡½æ•¸ä¾†å‹•æ…‹é¡¯ç¤ºçµ±è¨ˆ

3. **common/types/player.types.ts**
   - æ·»åŠ  `PlayerStats` æ¥å£
   - ç‚º `Player` æ·»åŠ å¯é¸çš„ `stats` å­—æ®µ

### å¾Œç«¯
4. **backend/src/modules/stats/stats.service.ts** â­ æ–°æ–‡ä»¶
   - å‰µå»ºçµ±è¨ˆæœå‹™ä¾†ç®¡ç†ç©å®¶çµ±è¨ˆæ•¸æ“š

5. **backend/src/modules/matchmaking/matchmaking.service.ts**
   - åœ¨å‰µå»ºç©å®¶æ™‚åˆå§‹åŒ–çµ±è¨ˆæ•¸æ“š

6. **backend/src/modules/gateway/game.gateway.ts**
   - åœ¨éŠæˆ²çµæŸæ™‚æ›´æ–°çµ±è¨ˆæ•¸æ“š
   - æ·»åŠ  `updatePlayerStats()` ç§æœ‰æ–¹æ³•

7. **backend/src/app.module.ts**
   - è¨»å†Š `StatsService`

## æ•ˆæœå°æ¯”

### æ£‹ç›¤å°ºå¯¸

| è¢å¹•å°ºå¯¸ | èˆŠç‰ˆ | æ–°ç‰ˆ | æ£‹ç›¤ç¸½å°ºå¯¸ |
|---------|------|------|-----------|
| å°ç­†é›» (769-1024px, â‰¤768pxé«˜) | 36px | **22px** | **330px** â¬‡ï¸ |
| å°ç­†é›» (769-1024px, 769-900pxé«˜) | 36px | **26px** | **390px** â¬‡ï¸ |
| å°ç­†é›» (769-1024px, >900pxé«˜) | 36px | **24px** | **360px** â¬‡ï¸ |
| ä¸­æ¡Œé¢ (1025-1440px) | 36px | **30px** | **450px** |
| å¤§æ¡Œé¢ (>1440px) | 42px | **36px** | **540px** â¬‡ï¸ |

### çµ±è¨ˆåŠŸèƒ½

- âœ… **å‹åˆ©çµ±è¨ˆ**ï¼šæ¯æ¬¡ç²å‹å¾Œï¼Œå‹å ´æ•¸ +1
- âœ… **å¤±æ•—çµ±è¨ˆ**ï¼šæ¯æ¬¡å¤±æ•—å¾Œï¼Œæ•—å ´æ•¸ +1
- âœ… **æŒä¹…åŒ–**ï¼šçµ±è¨ˆæ•¸æ“šåœ¨æœå‹™å™¨é‹è¡ŒæœŸé–“ä¿æŒï¼ˆä»¥ç©å®¶åç¨±ç‚ºéµï¼‰
- âœ… **å¯¦æ™‚æ›´æ–°**ï¼šéŠæˆ²çµæŸå¾Œç«‹å³æ›´æ–°ä¸¦é¡¯ç¤º

## æ¸¬è©¦æ­¥é©Ÿ

### 1. æ¸¬è©¦æ£‹ç›¤å¤§å°
1. åœ¨ä¸åŒè¢å¹•å°ºå¯¸ä¸‹æ‰“é–‹éŠæˆ²
2. ç¢ºèªæ£‹ç›¤å®Œæ•´é¡¯ç¤ºï¼Œä¸éœ€è¦æ»¾å‹•
3. ç¢ºèªåº•éƒ¨æŒ‰éˆ•å¯è¦‹ä¸”å¯é»æ“Š

### 2. æ¸¬è©¦çµ±è¨ˆåŠŸèƒ½
1. å•Ÿå‹•å¾Œç«¯æœå‹™ï¼š`cd backend && pnpm start:dev`
2. å•Ÿå‹•å‰ç«¯æœå‹™ï¼š`cd frontend && pnpm dev`
3. æ‰“é–‹å…©å€‹ç€è¦½å™¨çª—å£é€²è¡Œé…å°
4. å®Œæˆä¸€å±€éŠæˆ²
5. ç¢ºèªå‹è€…çš„å‹å ´æ•¸å¢åŠ ï¼Œæ•—è€…çš„æ•—å ´æ•¸å¢åŠ 
6. å†ä¾†ä¸€å±€ï¼Œç¢ºèªçµ±è¨ˆæ•¸æ“šç´¯ç©

## æ§‹å»ºæ¸¬è©¦

```bash
# å‰ç«¯æ§‹å»º
cd frontend && pnpm build
# âœ“ built in 1.63s âœ…

# å¾Œç«¯æ§‹å»º
cd backend && pnpm build
# âœ… ç„¡éŒ¯èª¤
```

## æ³¨æ„äº‹é …

1. **çµ±è¨ˆæ•¸æ“šå­˜å„²**ï¼šç›®å‰ä½¿ç”¨å…§å­˜å­˜å„²ï¼ˆMapï¼‰ï¼Œæœå‹™å™¨é‡å•Ÿå¾Œæ•¸æ“šæœƒä¸Ÿå¤±
2. **ç©å®¶è­˜åˆ¥**ï¼šä½¿ç”¨ç©å®¶åç¨±ä½œç‚ºéµï¼Œç›¸åŒåç¨±çš„ç©å®¶å…±äº«çµ±è¨ˆæ•¸æ“š
3. **æœªä¾†æ”¹é€²**ï¼šå¯ä»¥æ·»åŠ æ•¸æ“šåº«æŒä¹…åŒ–ã€ç”¨æˆ¶èªè­‰ç³»çµ±ç­‰

## å•Ÿå‹•æœå‹™

```bash
# å•Ÿå‹•å¾Œç«¯ï¼ˆé–‹ç™¼æ¨¡å¼ï¼‰
cd backend
pnpm start:dev

# å•Ÿå‹•å‰ç«¯ï¼ˆé–‹ç™¼æ¨¡å¼ï¼‰
cd frontend
pnpm dev
```

ç¾åœ¨å¯ä»¥æ¸¬è©¦å®Œæ•´çš„çµ±è¨ˆåŠŸèƒ½äº†ï¼ğŸ‰

