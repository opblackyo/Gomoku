# 局域网连接配置说明

## ✅ 已完成的配置

### 1. 前端配置 (Vite)
- ✅ 设置 `host: '0.0.0.0'` - 允许局域网访问
- ✅ Socket.IO 客户端自动使用当前主机地址

### 2. 后端配置 (NestJS)
- ✅ CORS 设置为 `origin: true` - 允许所有来源
- ✅ 监听地址设置为 `'0.0.0.0'` - 监听所有网络接口
- ✅ WebSocket Gateway CORS 配置已更新

### 3. 服务器状态
- ✅ 后端运行在: `http://0.0.0.0:3001`
- ✅ 前端运行在: `http://0.0.0.0:3000`

## 📱 如何使用

### 你的局域网 IP 地址
根据 ipconfig 输出，你有以下 IP 地址：
- `10.111.5.156` (可能是公司/学校网络)
- `192.168.2.1` (可能是虚拟网卡)
- `192.168.41.1` (可能是虚拟网卡)
- `26.132.149.167` (可能是 VPN)

**推荐使用**: `10.111.5.156` (如果在同一局域网)

### 局域网内其他设备访问

1. **确保设备在同一局域网**
   - 连接到同一个 WiFi 或有线网络

2. **访问地址**
   - 前端: `http://10.111.5.156:3000`
   - 后端: `http://10.111.5.156:3001`

3. **在浏览器中打开**
   - 电脑: 直接在浏览器输入 `http://10.111.5.156:3000`
   - 手机: 在浏览器输入 `http://10.111.5.156:3000`
   - 平板: 在浏览器输入 `http://10.111.5.156:3000`

## 🔥 防火墙设置

如果无法连接，需要允许端口 3000 和 3001：

### Windows 防火墙规则

```powershell
# 允许端口 3000 (前端)
New-NetFirewallRule -DisplayName "Gomoku Frontend" -Direction Inbound -LocalPort 3000 -Protocol TCP -Action Allow

# 允许端口 3001 (后端)
New-NetFirewallRule -DisplayName "Gomoku Backend" -Direction Inbound -LocalPort 3001 -Protocol TCP -Action Allow
```

### 或者临时关闭防火墙测试
1. 打开 Windows 设置
2. 搜索"防火墙"
3. 点击"启用或关闭 Windows Defender 防火墙"
4. 临时关闭私人网络防火墙进行测试

## 🧪 测试连接

### 1. 在服务器本机测试
```
http://localhost:3000
```

### 2. 在局域网其他设备测试
```
http://10.111.5.156:3000
```

### 3. 检查后端连接
打开浏览器开发者工具 (F12)，查看 Console 和 Network 标签：
- 应该看到 Socket.IO 连接成功
- 不应该有 `ERR_CONNECTION_REFUSED` 错误

## 🎮 多人游戏测试

1. **在两个设备上打开游戏**
   - 设备 1: `http://10.111.5.156:3000`
   - 设备 2: `http://10.111.5.156:3000`

2. **输入玩家名称并点击"寻找对手"**

3. **配对成功后开始游戏**

## 🔧 故障排除

### 问题 1: 无法访问前端
- 检查前端是否正在运行: `netstat -ano | findstr :3000`
- 检查防火墙设置
- 尝试使用不同的 IP 地址

### 问题 2: Socket.IO 连接失败
- 检查后端是否正在运行: `netstat -ano | findstr :3001`
- 查看浏览器控制台错误信息
- 确认后端日志中有 "Backend server is running on http://0.0.0.0:3001"

### 问题 3: 配对失败
- 确保两个客户端都连接到同一个后端服务器
- 检查后端日志是否有错误
- 刷新页面重试

## 📝 环境变量配置 (可选)

如果需要指定特定的后端地址，可以创建 `frontend/.env` 文件：

```env
# 指定后端地址
VITE_SOCKET_URL=http://10.111.5.156:3001
```

然后重启前端服务。

## ⚠️ 安全提示

当前配置适合**开发和局域网环境**。

**不要在公网环境使用此配置！**

生产环境需要：
- 配置具体的 CORS 域名白名单
- 添加身份验证
- 使用 HTTPS
- 添加速率限制
- 配置安全的 WebSocket 连接

## 🚀 启动命令

### 启动后端
```powershell
cd backend
pnpm start:dev
```

### 启动前端
```powershell
cd frontend
pnpm dev
```

### 同时启动前后端
```powershell
pnpm dev
```

## 📞 需要帮助？

如果遇到问题：
1. 检查后端日志
2. 检查浏览器控制台
3. 确认防火墙设置
4. 确认设备在同一局域网

