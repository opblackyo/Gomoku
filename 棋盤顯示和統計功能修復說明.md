# 棋盤顯示和統計功能修復說明

## 問題描述

### 1. 棋盤下方突出
棋盤底部的座標（A-O）被切掉，無法完整顯示。

### 2. 計分勝負沒有作用
玩家資訊顯示的是固定的 "0勝 0敗 0無"，沒有實際統計功能。

## 問題原因

### 1. 棋盤顯示問題
- `.board-wrapper` 設置了 `max-height: 100%`，但父容器沒有明確的高度
- Flexbox 子元素默認不會縮小，導致內容溢出

### 2. 統計功能問題
- `Player` 類型中沒有統計數據字段
- 前端硬編碼顯示 "0勝 0敗 0無"

## 解決方案

### 1. 修復棋盤顯示（BoardComponent.vue）

添加 `min-height: 0` 允許 flex 子元素縮小：

```css
.board-container {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: auto;
  padding: 0.5rem;
  min-height: 0; /* 關鍵：允許 flex 子元素縮小 */
}

.board-wrapper {
  display: flex;
  flex-direction: column;
  background: #daa520;
  border-radius: 8px;
  padding: 0.5rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  /* 移除 max-width 和 max-height，讓內容自然決定大小 */
}
```

**關鍵點：**
- `min-height: 0` 是 Flexbox 的重要屬性，允許子元素縮小到內容大小以下
- 移除 `max-height: 100%` 和 `max-width: 100%`，讓內容自然決定大小
- 保持 `overflow: auto`，當內容過大時顯示滾動條

### 2. 添加統計功能支持

#### 2.1 擴展 Player 類型（common/types/player.types.ts）

```typescript
export interface PlayerStats {
  wins: number;
  losses: number;
  draws: number;
}

export interface Player {
  id: string;
  name: string;
  socketId: string;
  stats?: PlayerStats; // 可選的統計數據
}
```

#### 2.2 更新前端顯示（GameView.vue）

```vue
<template>
  <div class="player-stats">{{ getPlayerStats(0) }}</div>
</template>

<script setup lang="ts">
const getPlayerStats = (playerIndex: number): string => {
  if (!room.value || !room.value.players[playerIndex]) {
    return '0勝 0敗 0無';
  }
  const stats = room.value.players[playerIndex].stats;
  if (!stats) {
    return '0勝 0敗 0無';
  }
  return `${stats.wins}勝 ${stats.losses}敗 ${stats.draws}無`;
};
</script>
```

## 修改的文件

1. **common/types/player.types.ts**
   - 添加 `PlayerStats` 接口
   - 為 `Player` 接口添加可選的 `stats` 字段

2. **frontend/src/components/BoardComponent.vue**
   - 修復 `.board-container` 樣式，添加 `min-height: 0`
   - 移除 `.board-wrapper` 的 `max-height` 和 `max-width`

3. **frontend/src/views/GameView.vue**
   - 將硬編碼的統計顯示改為動態函數 `getPlayerStats()`
   - 添加 `getPlayerStats()` 函數來讀取玩家統計數據

## 效果

### 1. 棋盤顯示
- ✅ 底部座標（A-O）完整顯示
- ✅ 棋盤在所有螢幕尺寸下都能正確顯示
- ✅ 當內容過大時，容器會顯示滾動條

### 2. 統計功能
- ✅ 前端已準備好顯示統計數據
- ⚠️ 後端需要實現統計數據的存儲和更新（見下方說明）

## 後端實現建議

目前前端已經支持顯示統計數據，但後端還需要實現以下功能：

### 1. 添加玩家統計存儲

可以使用以下方式之一：
- **內存存儲**：使用 Map 存儲玩家統計（簡單但重啟後丟失）
- **數據庫存儲**：使用 MongoDB/PostgreSQL 等（持久化）
- **Redis 存儲**：使用 Redis（快速且可持久化）

### 2. 更新統計邏輯

在遊戲結束時更新統計：

```typescript
// backend/src/modules/game/game.service.ts
updatePlayerStats(room: Room, result: GameResult) {
  const winner = room.players.find(p => p.id === result.winner);
  const loser = room.players.find(p => p.id !== result.winner);
  
  if (winner && winner.stats) {
    winner.stats.wins++;
  }
  if (loser && loser.stats) {
    loser.stats.losses++;
  }
}
```

### 3. 初始化玩家統計

在創建玩家時初始化統計：

```typescript
// backend/src/modules/matchmaking/matchmaking.service.ts
createPlayer(playerName: string, socketId: string): Player {
  return {
    id: uuidv4(),
    name: playerName,
    socketId,
    stats: {
      wins: 0,
      losses: 0,
      draws: 0
    }
  };
}
```

## 測試建議

### 1. 棋盤顯示測試
- ✅ 在不同螢幕尺寸下測試（手機、平板、桌面）
- ✅ 確認底部座標完整顯示
- ✅ 確認棋盤不會超出螢幕

### 2. 統計功能測試
- 當後端實現統計功能後：
  - 測試遊戲結束後統計是否正確更新
  - 測試重新配對後統計是否保留
  - 測試斷線重連後統計是否正確

## 構建測試

```bash
cd frontend && pnpm build
# ✓ built in 1.97s
# ✅ 構建成功
```

## 注意事項

1. **統計數據持久化**：目前統計數據是可選的（`stats?`），如果後端沒有提供，前端會顯示 "0勝 0敗 0無"
2. **向後兼容**：由於 `stats` 是可選字段，不會影響現有功能
3. **未來擴展**：可以添加更多統計數據，如：
   - 連勝次數
   - 平均每局時間
   - 最長連勝記錄
   - 勝率百分比

