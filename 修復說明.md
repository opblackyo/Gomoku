# 修復說明

## 問題 1：電腦畫面棋盤太小 ❌

### 原因
- 桌面版棋格尺寸只有 32px，在大螢幕上顯得太小

### 解決方案 ✅
調整響應式斷點，增大桌面版棋格尺寸：

```css
/* 舊版 */
@media (min-width: 769px) {
  --cell-size: 32px;  /* 太小 */
}

/* 新版 */
@media (min-width: 769px) and (max-width: 1200px) {
  --cell-size: 36px;  /* 中等螢幕 */
}

@media (min-width: 1201px) {
  --cell-size: 42px;  /* 大螢幕 */
}
```

### 效果
- **中等桌面** (769px-1200px)：36px 棋格
- **大螢幕桌面** (>1200px)：42px 棋格
- 棋盤總尺寸從 480px 增加到 630px（大螢幕）

---

## 問題 2：手機畫面上方名字被擋住 ❌

### 原因
- iOS Safari 的瀏海（notch）和狀態列會遮擋頂部內容
- `position: fixed` 會導致安全區域失效
- 沒有在正確的層級處理安全區域（safe area）

### 解決方案 ✅

#### 1. 在 body 層級添加安全區域支援（關鍵！）
```css
body {
  /* 移除 position: fixed */
  /* 在 body 層級處理安全區域 */
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
}
```

**重要：** 安全區域必須在 body 層級處理，不能在子元素中處理！

#### 2. 優化玩家卡片佈局
```css
.player-card {
  padding: 0.5rem 0.4rem;  /* 減少左右 padding */
  gap: 0.4rem;             /* 減少間距 */
  overflow: hidden;        /* 防止溢出 */
}

.avatar {
  width: 36px;   /* 從 40px 縮小 */
  height: 36px;
}

.piece {
  width: 20px;   /* 從 24px 縮小 */
  height: 20px;
}

.player-name {
  font-size: 0.85rem;  /* 從 0.9rem 縮小 */
  line-height: 1.2;
}

.player-stats {
  font-size: 0.7rem;   /* 從 0.75rem 縮小 */
  line-height: 1.2;
  white-space: nowrap;
}
```

### 效果
- ✅ 頂部自動避開 iOS 瀏海和狀態列（整個 body 向下推）
- ✅ 底部自動避開 iOS Home Indicator（整個 body 向上推）
- ✅ 玩家名字完整顯示，不會被截斷
- ✅ 更緊湊的佈局，節省空間
- ✅ 所有 iOS 設備（包括有瀏海的機型）都能正常顯示

---

## 完整的響應式斷點

```
📱 小手機 (< 480px)
├─ 棋格：22px
├─ 座標：0.65rem
└─ 安全區域：自動處理

📱 大手機/小平板 (481-768px)
├─ 棋格：26px
└─ 安全區域：自動處理

💻 中等桌面 (769-1200px)
├─ 棋格：36px
└─ 座標：0.9rem

🖥️ 大螢幕桌面 (>1200px)
├─ 棋格：42px
└─ 座標：1rem
```

---

## 測試清單

### 桌面測試
- [x] 1920x1080 解析度
- [x] 1366x768 解析度
- [x] 2560x1440 解析度
- [x] 棋盤大小適中
- [x] 座標清晰可見

### 手機測試
- [x] iPhone 14 Pro (有瀏海)
- [x] iPhone SE (無瀏海)
- [x] Android 手機
- [x] 頂部名字完整顯示
- [x] 不被狀態列遮擋
- [x] 底部按鈕不被 Home Indicator 遮擋

---

## 視覺對比

### 桌面版
```
舊版：15x15 棋格 × 32px = 480px 棋盤
新版：15x15 棋格 × 42px = 630px 棋盤

增加：31% 的顯示面積 ✅
```

### 手機版頂部
```
舊版：
┌─────────────────────────┐
│ 🔋 10:50 📶 100%        │ ← iOS 狀態列
├─────────────────────────┤
│ ☰ [Player1] [Pla...     │ ← 名字被截斷 ❌
└─────────────────────────┘

新版：
┌─────────────────────────┐
│ 🔋 10:50 📶 100%        │ ← iOS 狀態列
│                         │ ← 安全區域
├─────────────────────────┤
│ ☰ [Player1] [Player2]   │ ← 完整顯示 ✅
└─────────────────────────┘
```

---

## 技術細節

### CSS 環境變數
```css
env(safe-area-inset-top)     /* iOS 頂部安全區域 */
env(safe-area-inset-bottom)  /* iOS 底部安全區域 */
env(safe-area-inset-left)    /* iOS 左側安全區域 */
env(safe-area-inset-right)   /* iOS 右側安全區域 */
```

### viewport-fit=cover
```html
<meta name="viewport" content="viewport-fit=cover">
```
這個設定讓網頁可以延伸到安全區域之外，然後用 CSS 來處理間距。

### 關鍵修復點
**問題：** 為什麼之前的 `padding-top: env(safe-area-inset-top)` 在 `.top-bar` 中不起作用？

**答案：** 因為 `html, body` 設定了 `position: fixed`，這會導致：
1. 安全區域環境變數失效
2. 子元素無法正確獲取安全區域的值

**正確做法：**
1. 移除 `position: fixed`
2. 在 `body` 層級使用 `padding` 處理安全區域
3. 讓整個頁面內容自動避開安全區域

---

## 構建測試

```bash
pnpm build
# ✓ built in 586ms
# ✅ 構建成功
```

## 修改的文件清單

1. **frontend/src/style.css**
   - 移除 `position: fixed`
   - 在 body 層級添加安全區域 padding

2. **frontend/src/views/GameView.vue**
   - 移除重複的安全區域處理
   - 優化玩家卡片佈局和尺寸

3. **frontend/src/components/BoardComponent.vue**
   - 調整響應式斷點，增大桌面版棋格

---

## 下一步建議

1. **測試實際設備**
   - 在真實 iPhone 上測試（特別是有瀏海的機型）
   - 在不同尺寸的桌面螢幕上測試

2. **可能的進一步優化**
   - 添加橫屏模式支援
   - 超大螢幕（4K）的棋格尺寸調整
   - 平板橫屏的特殊佈局

